library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.std_logic_unsigned.all;
use ieee.numeric_std.all;


entity MaqEstad is
 PORT(boton_c,boton_l,boton_latte, boton_cortado,boton_choco,azucar,reset,clk: IN std_logic;
 led_corto,led_largo,led_espera,led_listo, led_cortado,led_latte,led_choco: OUT std_logic;
 count: in std_logic_vector(4 down to 0)
 );
 
end MaqEstad;

architecture Behavioral of MaqEstad is
TYPE estado IS (espera,preparando_c,preparando_l,preparando_latte,preparando_cortado,preparando_choco,listo);

SIGNAL presente:estado:=espera;
SIGNAL resetcont: boolean:=false; --Resetea contador
SIGNAL fin_largo, fin_corto, fin_choco,fin_latte,fin_cortado,fin_azucar:boolean; --Indica el fin de la cuenta, para tipos de cafes.
SIGNAL cuenta:integer RANGE 0 TO 29;


begin
maquina: 
PROCESS(clk, reset)
begin
    IF reset='1' THEN
        presente<=espera;
    ELSE IF clk='1' AND clk'EVENT THEN
        CASE presente IS
            WHEN espera =>
                IF boton_c='1' THEN
                    presente<=preparando_c;
                END IF;
                ELSEIF boton_l='1' THEN
                presente<=preparando_l;
                END IF;
                 ELSEIF boton_cortado='1' THEN
                presente<=preparando_cortado;
                END IF;
                ELSEIF boton_latte='1' THEN
                presente<=preparando_latte;
                END IF;
                ELSEIF boton_choco='1' THEN
                presente<=preparando_choco;
                END IF;
                
            WHEN preparando_c =>
                IF fin_corto THEN
                    presente<=listo;
                END IF;
            WHEN preparando_l =>
                IF fin_largo THEN
                    presente<=listo;
                END IF;
            WHEN preparando_latte =>
              IF fin_latte THEN
                  presente<=listo;
              END IF;
            WHEN preparando_cortado =>
              IF fin_cortado THEN
                  presente<=listo;
              END IF;
            WHEN preparando_choco =>
              IF fin_choco THEN
                  presente<=listo;
              END IF;
            WHEN listo =>
              wait 300;
                presente<= espera;
        END CASE;
    END IF;
    END IF;
end process;


salida:
process(presente)
BEGIN
    CASE presente IS
        WHEN espera =>
            led_espera<= '1';
            led_corto<= '0';
            led_largo<= '0';
            led_cortado<= '0';
            led_latte<= '0';
            led_choco<= '0';
            led_listo<='0';
            resetcont<=false;
        WHEN preparando_c =>
            led_espera<= '0';
            led_corto<='1';
            resetcont<=false;
          IF azucar='1' THEN 
           IF fin_azucar='0'
              led_azucar<='1';
           END IF;
          ELSE led_azucar<= '0';
            resetcont<=false;
        WHEN preparando_l =>
            led_espera<= '0';   
            led_largo<='1';
          IF azucar='1' THEN 
           IF fin_azucar='0'
              led_azucar<='1';
           END IF;
          ELSE led_azucar<= '0';
            resetcont<=false;
        WHEN preparando_latte =>
            led_espera<= '0';   
            led_latte='1';
          IF azucar='1' THEN 
           IF fin_azucar='0'
              led_azucar<='1';
           END IF;
          ELSE led_azucar<= '0';
            resetcont<=false;
        WHEN preparando_cortado =>
          led_espera<= '0';   
          led_cortado='1';
         IF azucar='1' THEN 
           IF fin_azucar='0'
              led_azucar<='1';
           END IF;
          ELSE led_azucar<= '0';
          resetcont<=false;
        WHEN preparando_choco =>
          led_espera<= '0';   
          led_choco='1';
          IF azucar='1' THEN 
           IF fin_azucar='0'
              led_azucar<='1';
           END IF;
          ELSE led_azucar<= '0';
          resetcont<=false;
        WHEN listo =>
            led_espera<= '0';
            led_corto<= '0';
            led_largo<= '0';
            led_cortado<= '0';
            led_latte<= '0';
            led_choco <='0';
            led_listo<='1';
            resetcont<=true;
    END CASE;
END process salida; 
contador:
PROCESS(clk)
BEGIN
IF clk='1' THEN
IF rescont THEN cuenta<=0;
ELSE cuenta<=cuenta+1;
END IF;
END IF;
END PROCESS contador;

fin_largo<=true WHEN count=5 ELSE false;
fin_corto<=true WHEN count=3 ELSE false;
leche_corto <= true WHEN count=3 ELSE false;
leche_largo <= true WHEN count=5 ELSE false;
choco_fin <= true WHEN count=8 ELSE false;
azucar_fin <= true WHEN  count=2 ELSE false;
END behavioral;
